local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ProximityMaster"

local mainWindow = Instance.new("Frame")
mainWindow.Size = UDim2.new(0, 220, 0, 140)
mainWindow.Position = UDim2.new(0.4, 0, 0.4, 0)
mainWindow.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
mainWindow.Active = true
mainWindow.Draggable = true

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 6)
corner.Parent = mainWindow

local topBar = Instance.new("Frame")
topBar.Size = UDim2.new(1, 0, 0, 30)
topBar.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
topBar.BorderSizePixel = 0
local topCorner = Instance.new("UICorner")
topCorner.CornerRadius = UDim.new(0, 6)
topCorner.Parent = topBar

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 25, 0, 25)
toggleButton.Position = UDim2.new(1, -30, 0.5, -12)
toggleButton.Text = "-"
toggleButton.TextColor3 = Color3.fromRGB(220, 220, 255)
toggleButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 16
local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 4)
toggleCorner.Parent = toggleButton

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -40, 1, 0)
title.Position = UDim2.new(0, 10, 0, 0)
title.Text = "PROMPT CONTROL"
title.TextColor3 = Color3.fromRGB(220, 220, 255)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextSize = 14
title.TextXAlignment = Enum.TextXAlignment.Left

local content = Instance.new("Frame")
content.Size = UDim2.new(1, -10, 0, 100)
content.Position = UDim2.new(0, 5, 0, 35)
content.BackgroundTransparency = 1

local promptInfo = Instance.new("TextLabel")
promptInfo.Size = UDim2.new(1, 0, 0, 25)
promptInfo.Position = UDim2.new(0, 0, 0, 0)
promptInfo.Text = "No prompt"
promptInfo.TextColor3 = Color3.fromRGB(200, 200, 220)
promptInfo.BackgroundTransparency = 1
promptInfo.Font = Enum.Font.Gotham
promptInfo.TextSize = 12

local distanceLabel = Instance.new("TextLabel")
distanceLabel.Size = UDim2.new(1, 0, 0, 20)
distanceLabel.Position = UDim2.new(0, 0, 0, 25)
distanceLabel.Text = "Distance: --"
distanceLabel.TextColor3 = Color3.fromRGB(180, 180, 200)
distanceLabel.BackgroundTransparency = 1
distanceLabel.Font = Enum.Font.Gotham
distanceLabel.TextSize = 11

local selectButton = Instance.new("TextButton")
selectButton.Size = UDim2.new(0.45, 0, 0, 25)
selectButton.Position = UDim2.new(0, 0, 0, 50)
selectButton.Text = "SELECT"
selectButton.TextColor3 = Color3.fromRGB(255, 255, 255)
selectButton.BackgroundColor3 = Color3.fromRGB(80, 100, 180)
selectButton.Font = Enum.Font.GothamSemibold
selectButton.TextSize = 12

local activateButton = Instance.new("TextButton")
activateButton.Size = UDim2.new(0.45, 0, 0, 25)
activateButton.Position = UDim2.new(0.55, 0, 0, 50)
activateButton.Text = "ACTIVATE"
activateButton.TextColor3 = Color3.fromRGB(255, 255, 255)
activateButton.BackgroundColor3 = Color3.fromRGB(80, 180, 100)
activateButton.Font = Enum.Font.GothamSemibold
activateButton.TextSize = 12

local madeBy = Instance.new("TextLabel")
madeBy.Size = UDim2.new(1, 0, 0, 15)
madeBy.Position = UDim2.new(0, 0, 1, -15)
madeBy.Text = "by Wandri"
madeBy.TextColor3 = Color3.fromRGB(150, 150, 180)
madeBy.BackgroundTransparency = 1
madeBy.Font = Enum.Font.Gotham
madeBy.TextSize = 10
madeBy.TextTransparency = 0.7

title.Parent = topBar
toggleButton.Parent = topBar
topBar.Parent = mainWindow

promptInfo.Parent = content
distanceLabel.Parent = content
selectButton.Parent = content
activateButton.Parent = content
madeBy.Parent = content
content.Parent = mainWindow

mainWindow.Parent = screenGui
screenGui.Parent = playerGui

local selectedPrompt = nil
local isMinimized = false
local distanceUpdate = nil
local currentHighlight = nil
local originalSettings = {}

local function updateDistance()
	if distanceUpdate then
		distanceUpdate:Disconnect()
	end
	
	distanceUpdate = game:GetService("RunService").Heartbeat:Connect(function()
		if selectedPrompt and selectedPrompt.Parent then
			local character = player.Character
			if character and character:FindFirstChild("HumanoidRootPart") then
				local playerPos = character.HumanoidRootPart.Position
				local promptPos = selectedPrompt.Parent.Position
				local distance = (playerPos - promptPos).Magnitude
				distanceLabel.Text = "Distance: " .. math.floor(distance)
			end
		else
			distanceLabel.Text = "Distance: --"
		end
	end)
end

local function resetPreviousPrompt()
	if selectedPrompt then
		if originalSettings[selectedPrompt] then
			selectedPrompt.MaxActivationDistance = originalSettings[selectedPrompt].MaxActivationDistance
			selectedPrompt.HoldDuration = originalSettings[selectedPrompt].HoldDuration
			selectedPrompt.RequiresLineOfSight = originalSettings[selectedPrompt].RequiresLineOfSight
			originalSettings[selectedPrompt] = nil
		end
	end
	
	if currentHighlight then
		currentHighlight:Destroy()
		currentHighlight = nil
	end
end

local function selectPrompt()
	local character = player.Character
	if not character or not character:FindFirstChild("HumanoidRootPart") then
		promptInfo.Text = "No character"
		return
	end
	
	resetPreviousPrompt()
	
	local playerPos = character.HumanoidRootPart.Position
	local nearestPrompt = nil
	local nearestDistance = math.huge
	
	for _, obj in pairs(game.Workspace:GetDescendants()) do
		if obj:IsA("ProximityPrompt") and obj.Enabled then
			local parent = obj.Parent
			if parent:IsA("BasePart") then
				local promptPos = parent.Position
				local distance = (playerPos - promptPos).Magnitude
				
				if distance < nearestDistance and distance < 100 then
					nearestPrompt = obj
					nearestDistance = distance
				end
			end
		end
	end
	
	if nearestPrompt then
		selectedPrompt = nearestPrompt
		
		originalSettings[nearestPrompt] = {
			MaxActivationDistance = nearestPrompt.MaxActivationDistance,
			HoldDuration = nearestPrompt.HoldDuration,
			RequiresLineOfSight = nearestPrompt.RequiresLineOfSight
		}
		
		nearestPrompt.MaxActivationDistance = 1000
		nearestPrompt.HoldDuration = 0
		nearestPrompt.RequiresLineOfSight = false
		
		promptInfo.Text = nearestPrompt.Name
		
		currentHighlight = Instance.new("Highlight")
		currentHighlight.Name = "SelectedPromptHighlight"
		currentHighlight.FillColor = Color3.fromRGB(100, 255, 100)
		currentHighlight.FillTransparency = 0.7
		currentHighlight.OutlineColor = Color3.fromRGB(255, 255, 200)
		currentHighlight.Parent = nearestPrompt.Parent
		
		updateDistance()
	else
		promptInfo.Text = "No prompts near"
		selectedPrompt = nil
	end
end

local function activatePrompt()
	if not selectedPrompt then
		selectPrompt()
		if not selectedPrompt then
			promptInfo.Text = "Select first"
			return
		end
	end
	
	if selectedPrompt.Enabled then
		selectedPrompt:InputHoldBegin()
		selectedPrompt:InputHoldEnd()
		promptInfo.Text = "Activated!"
		
		task.delay(1, function()
			if selectedPrompt then
				promptInfo.Text = selectedPrompt.Name
			end
		end)
	end
end

local function toggleMinimize()
	isMinimized = not isMinimized
	
	if isMinimized then
		mainWindow.Size = UDim2.new(0, 220, 0, 30)
		content.Visible = false
		toggleButton.Text = "+"
	else
		mainWindow.Size = UDim2.new(0, 220, 0, 140)
		content.Visible = true
		toggleButton.Text = "-"
	end
end

toggleButton.MouseButton1Click:Connect(toggleMinimize)
selectButton.MouseButton1Click:Connect(selectPrompt)
activateButton.MouseButton1Click:Connect(activatePrompt)

player.CharacterAdded:Connect(function()
	task.wait(1)
	selectPrompt()
end)

if player.Character then
	task.wait(1)
	selectPrompt()
end

screenGui.Destroying:Connect(function()
	if distanceUpdate then
		distanceUpdate:Disconnect()
	end
	if currentHighlight then
		currentHighlight:Destroy()
	end
	for prompt, settings in pairs(originalSettings) do
		if prompt and prompt.Parent then
			prompt.MaxActivationDistance = settings.MaxActivationDistance
			prompt.HoldDuration = settings.HoldDuration
			prompt.RequiresLineOfSight = settings.RequiresLineOfSight
		end
	end
end)
